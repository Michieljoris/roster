<!DOCTYPE html><html><head><title>viewTree.js</title><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><link rel="stylesheet" media="all" href="../docco.css"></head><body><div id="container"><div id="background"></div><div id="jump_to">Jump To &hellip;<div id="jump_wrapper"><div id="jump_page"><a href="../index.html" class="source"><span class="file_name">README</span></a><a href="../js/layout.js.html" class="source "><span class="base_path">js / </span><span class="file_name">layout.js</span></a><a href="../js/calculateTimesheet.js.html" class="source "><span class="base_path">js / </span><span class="file_name">calculateTimesheet.js</span></a><a href="../js/main.js.html" class="source "><span class="base_path">js / </span><span class="file_name">main.js</span></a><a href="../js/globals.js.html" class="source "><span class="base_path">js / </span><span class="file_name">globals.js</span></a><a href="../js/old/liveorig.js.html" class="source "><span class="base_path">js / old / </span><span class="file_name">liveorig.js</span></a><a href="../js/old/dataclasses.js.html" class="source "><span class="base_path">js / old / </span><span class="file_name">dataclasses.js</span></a><a href="../js/old/data-structures.js.html" class="source "><span class="base_path">js / old / </span><span class="file_name">data-structures.js</span></a><a href="../js/old/viewtree.js.html" class="source "><span class="base_path">js / old / </span><span class="file_name">viewtree.js</span></a><a href="../js/old/testsc.js.html" class="source "><span class="base_path">js / old / </span><span class="file_name">testsc.js</span></a><a href="../js/old/nodejuice.js.html" class="source "><span class="base_path">js / old / </span><span class="file_name">nodejuice.js</span></a><a href="../js/old/utils.js.html" class="source "><span class="base_path">js / old / </span><span class="file_name">utils.js</span></a><a href="../js/old/smartclientui.js.html" class="source "><span class="base_path">js / old / </span><span class="file_name">smartclientui.js</span></a><a href="../js/old/data-structures.coffee.html" class="source "><span class="base_path">js / old / </span><span class="file_name">data-structures.coffee</span></a><a href="../js/old/testpouch.js.html" class="source "><span class="base_path">js / old / </span><span class="file_name">testpouch.js</span></a><a href="../js/old/roster.js.html" class="source "><span class="base_path">js / old / </span><span class="file_name">roster.js</span></a><a href="../js/old/datasources.js.html" class="source "><span class="base_path">js / old / </span><span class="file_name">datasources.js</span></a><a href="../js/table.js.html" class="source "><span class="base_path">js / </span><span class="file_name">table.js</span></a><a href="../js/typesAndFields.js.html" class="source "><span class="base_path">js / </span><span class="file_name">typesAndFields.js</span></a><a href="../js/shiftEditor.js.html" class="source "><span class="base_path">js / </span><span class="file_name">shiftEditor.js</span></a><a href="../js/fetchTimesheetShifts.js.html" class="source "><span class="base_path">js / </span><span class="file_name">fetchTimesheetShifts.js</span></a><a href="../js/timesheet_canvas.js.html" class="source "><span class="base_path">js / </span><span class="file_name">timesheet_canvas.js</span></a><a href="../js/shift.js.html" class="source "><span class="base_path">js / </span><span class="file_name">shift.js</span></a><a href="../js/personEditor.js.html" class="source "><span class="base_path">js / </span><span class="file_name">personEditor.js</span></a><a href="../js/editorManager.js.html" class="source "><span class="base_path">js / </span><span class="file_name">editorManager.js</span></a><a href="../js/editorUtils.js.html" class="source "><span class="base_path">js / </span><span class="file_name">editorUtils.js</span></a><a href="../js/parentListEditor.js.html" class="source "><span class="base_path">js / </span><span class="file_name">parentListEditor.js</span></a><a href="../js/testdata.js.html" class="source "><span class="base_path">js / </span><span class="file_name">testdata.js</span></a><a href="../js/pouchDS.js.html" class="source "><span class="base_path">js / </span><span class="file_name">pouchDS.js</span></a><a href="../js/viewTree.js.html" class="source selected"><span class="base_path">js / </span><span class="file_name">viewTree.js</span></a><a href="../js/quickpouch.js.html" class="source "><span class="base_path">js / </span><span class="file_name">quickpouch.js</span></a><a href="../js/editorLoader.js.html" class="source "><span class="base_path">js / </span><span class="file_name">editorLoader.js</span></a><a href="../js/timesheet.js.html" class="source "><span class="base_path">js / </span><span class="file_name">timesheet.js</span></a><a href="../js/calendar.js.html" class="source "><span class="base_path">js / </span><span class="file_name">calendar.js</span></a><a href="../js/locationEditor.js.html" class="source "><span class="base_path">js / </span><span class="file_name">locationEditor.js</span></a><a href="../js/shiftQualifier.js.html" class="source "><span class="base_path">js / </span><span class="file_name">shiftQualifier.js</span></a><a href="../js/test.js.html" class="source "><span class="base_path">js / </span><span class="file_name">test.js</span></a><a href="../js/calculateTimesheetColumn.js.html" class="source "><span class="base_path">js / </span><span class="file_name">calculateTimesheetColumn.js</span></a><a href="../js/tableFilter.js.html" class="source "><span class="base_path">js / </span><span class="file_name">tableFilter.js</span></a></div></div></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>viewTree.js</h1><div class="filepath">js/</div></th><th class="code"></th></tr></thead><tbody><tr id="section-1"><td class="docs"><div class="pilwrap"><a href="#section-1" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>lobal logger:false isc:false define:false</p></div><div class="body"></div></div><div class="dox"><div class="summary"><p>shint strict:true unused:true smarttabs:true eqeqeq:true immed: true undef:true</p></div><div class="body"></div></div><div class="dox"><div class="summary"><p>shint maxparams:4 maxcomplexity:7 maxlen:90 devel:true</p></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-2"><td class="docs"><div class="pilwrap"><a href="#section-2" class="pilcrow">&#182;</a></div><p>-----@ TOP ----- */</p>
</td><td class="code"><div class="highlight"><pre><span class="nx">define</span></pre></div></td></tr><tr id="section-3"><td class="docs"><div class="pilwrap"><a href="#section-3" class="pilcrow">&#182;</a></div><p>({inject: ['globals', 'table', 'calendar' ],</p>
</td><td class="code"><div class="highlight"><pre><span class="p">({</span><span class="nx">inject</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;globals&#39;</span><span class="p">,</span> <span class="s1">&#39;table&#39;</span><span class="p">,</span> <span class="s1">&#39;calendar&#39;</span><span class="p">,</span> <span class="s1">&#39;timesheet&#39;</span><span class="p">],</span>
  <span class="nx">factory</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">globals</span><span class="p">,</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">calendar</span><span class="p">,</span> <span class="nx">timesheet</span><span class="p">)</span> <span class="p">{</span>
      <span class="s2">&quot;use strict&quot;</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">log</span> <span class="o">=</span> <span class="nx">logger</span><span class="p">(</span><span class="s1">&#39;viewTree&#39;</span><span class="p">);</span></pre></div></td></tr><tr id="section-4"><td class="docs"><div class="pilwrap"><a href="#section-4" class="pilcrow">&#182;</a></div><p>dummy empty view for initialization purposes. Also a template
for more views.</p>
</td><td class="code"><div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">emptyView</span> <span class="o">=</span>
          <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Empty&#39;</span>
            <span class="p">,</span><span class="nx">getState</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{}</span>
            <span class="p">,</span><span class="nx">setObserver</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{}};</span>
      </pre></div></td></tr><tr id="section-5"><td class="docs"><div class="pilwrap"><a href="#section-5" class="pilcrow">&#182;</a></div><p>add new views to this list. Unfortunately you have to add it
three times. Once to inject, once to pass it in, and then to
add it to views, although we could read the args list..</p>
</td><td class="code"><div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">views</span> <span class="o">=</span> <span class="p">[</span>
          <span class="nx">emptyView</span>
          <span class="p">,</span><span class="nx">table</span>
          <span class="p">,</span><span class="nx">calendar</span>
          <span class="p">,</span><span class="nx">timesheet</span>
      <span class="p">];</span>
      <span class="kd">var</span> <span class="nx">newViewMenu</span> <span class="o">=</span> <span class="p">[];</span>
      
      <span class="nx">views</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">{};</span>
          <span class="kd">var</span> <span class="nx">proto</span> <span class="o">=</span> <span class="p">{</span>
              <span class="nx">click</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">newView</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span> <span class="p">}</span> 
              <span class="p">,</span><span class="nx">icon</span><span class="o">:</span> <span class="nx">isc</span><span class="p">.</span><span class="nx">Page</span><span class="p">.</span><span class="nx">getSkinDir</span><span class="p">()</span> <span class="o">+</span><span class="s2">&quot;images/actions/add.png&quot;</span>
          <span class="p">};</span>
          <span class="nx">views</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">v</span><span class="p">.</span><span class="nx">setObserver</span><span class="p">(</span><span class="nx">viewStateChanged</span><span class="p">);</span>
              <span class="kd">var</span> <span class="nx">aview</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">proto</span><span class="p">);</span>
              <span class="nx">aview</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
              <span class="nx">aview</span><span class="p">.</span><span class="nx">icon</span> <span class="o">=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">icon</span> <span class="o">||</span> <span class="nx">aview</span><span class="p">.</span><span class="nx">icon</span><span class="p">;</span>
              <span class="k">if</span> <span class="p">(</span><span class="nx">aview</span><span class="p">.</span><span class="nx">name</span> <span class="o">!==</span> <span class="s1">&#39;Empty&#39;</span><span class="p">)</span>
                  <span class="nx">newViewMenu</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">aview</span><span class="p">);</span>
              <span class="nx">result</span><span class="p">[</span><span class="nx">v</span><span class="p">.</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;</span>
          <span class="p">});</span>
          <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
      <span class="p">})();</span>
      
      <span class="kd">var</span> <span class="nx">show</span><span class="p">,</span> <span class="c1">//to be set by layout so we can show/hide views in the layout</span>
          <span class="nx">modified</span><span class="p">,</span> <span class="c1">//whether the ui has changed</span>
      </pre></div></td></tr><tr id="section-6"><td class="docs"><div class="pilwrap"><a href="#section-6" class="pilcrow">&#182;</a></div><p>for initialization purposes when there is no view at all defined</p>
</td><td class="code"><div class="highlight"><pre>          <span class="nx">leafShowing</span> <span class="o">=</span> <span class="p">{</span>
              <span class="nx">view</span><span class="o">:</span> <span class="s1">&#39;Empty&#39;</span>
          <span class="p">};</span>
      </pre></div></td></tr><tr id="section-7"><td class="docs"><div class="pilwrap"><a href="#section-7" class="pilcrow">&#182;</a></div><p>--------------------@HANDLING STATE----------------------------- </p>
</td><td class="code"><div class="highlight"><pre>      <span class="kd">function</span> <span class="nx">notify</span><span class="p">(</span><span class="nx">newState</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">viewTreeState</span> <span class="o">=</span> <span class="nx">isc</span><span class="p">.</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">decode</span><span class="p">(</span><span class="nx">newState</span><span class="p">);</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">viewTreeState</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr><tr id="section-8"><td class="docs"><div class="pilwrap"><a href="#section-8" class="pilcrow">&#182;</a></div><p>width of side bar</p>
</td><td class="code"><div class="highlight"><pre>              <span class="nx">viewTree</span><span class="p">.</span><span class="nx">setWidth</span><span class="p">(</span><span class="nx">viewTreeState</span><span class="p">.</span><span class="nx">width</span><span class="p">);</span></pre></div></td></tr><tr id="section-9"><td class="docs"><div class="pilwrap"><a href="#section-9" class="pilcrow">&#182;</a></div><p>clear the tree</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nx">tree</span><span class="p">.</span><span class="nx">removeList</span><span class="p">(</span><span class="nx">tree</span><span class="p">.</span><span class="nx">getChildren</span><span class="p">(</span><span class="nx">tree</span><span class="p">.</span><span class="nx">getRoot</span><span class="p">()));</span></pre></div></td></tr><tr id="section-10"><td class="docs"><div class="pilwrap"><a href="#section-10" class="pilcrow">&#182;</a></div><p>set the tree to the saved state</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nx">tree</span><span class="p">.</span><span class="nx">linkNodes</span><span class="p">(</span><span class="nx">viewTreeState</span><span class="p">.</span><span class="nx">state</span><span class="p">);</span>
              <span class="nx">log</span><span class="p">.</span><span class="nx">d</span><span class="p">(</span><span class="s1">&#39;path:::::&#39;</span><span class="p">,</span><span class="nx">viewTreeState</span><span class="p">.</span><span class="nx">pathOfLeafShowing</span><span class="p">);</span>
        <span class="nx">viewTree</span><span class="p">.</span><span class="nx">setSelectedPaths</span><span class="p">(</span><span class="nx">viewTreeState</span><span class="p">.</span><span class="nx">pathOfLeafShowing</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">selRecord</span> <span class="o">=</span> <span class="nx">viewTree</span><span class="p">.</span><span class="nx">getSelectedRecord</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">selRecord</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">selRecord</span><span class="p">.</span><span class="nx">isFolder</span><span class="p">)</span> <span class="p">{</span> 
            <span class="nx">openLeaf</span><span class="p">(</span><span class="nx">selRecord</span><span class="p">);</span>
        <span class="p">}</span></pre></div></td></tr><tr id="section-11"><td class="docs"><div class="pilwrap"><a href="#section-11" class="pilcrow">&#182;</a></div><p>not much use because there will be state change
callbacks from smartclient to come after this</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nx">setModified</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span></pre></div></td></tr><tr id="section-12"><td class="docs"><div class="pilwrap"><a href="#section-12" class="pilcrow">&#182;</a></div><p>so set a interval time to see if the state is really
different from the stored state and if so setModified to true</p>
</td><td class="code"><div class="highlight"><pre>              <span class="nb">window</span><span class="p">.</span><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">checkState</span><span class="p">,</span> <span class="mi">2000</span><span class="p">);</span></pre></div></td></tr><tr id="section-13"><td class="docs"><div class="pilwrap"><a href="#section-13" class="pilcrow">&#182;</a></div><p>now any changes made by user will be stored in the
leaf and tree when opening up another leaf, when the
user saves the tree to the db and when the user
navigates away and he gets a chance to mend his ways
and to save before leaving.</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nx">log</span><span class="p">.</span><span class="nx">d</span><span class="p">(</span><span class="s1">&#39;finished changing tree state&#39;</span><span class="p">);</span></pre></div></td></tr><tr id="section-14"><td class="docs"><div class="pilwrap"><a href="#section-14" class="pilcrow">&#182;</a></div><p>do an autosave every minute..
window.setInterval(autoSave, autoSaveInterval * 60000);</p>
</td><td class="code"><div class="highlight"><pre>          <span class="p">}</span>
          
      <span class="p">}</span> 
      
      <span class="kd">function</span> <span class="nx">checkState</span><span class="p">()</span> <span class="p">{</span>
          <span class="nx">log</span><span class="p">.</span><span class="nx">d</span><span class="p">(</span><span class="s2">&quot;Checking state&quot;</span><span class="p">);</span></pre></div></td></tr><tr id="section-15"><td class="docs"><div class="pilwrap"><a href="#section-15" class="pilcrow">&#182;</a></div><p>setModified(!isEqual(table.getState(), leafShowing.viewState));</p>
</td><td class="code"><div class="highlight"><pre>          <span class="nx">setModified</span><span class="p">(</span><span class="o">!</span><span class="nx">isEqual</span><span class="p">(</span><span class="nx">views</span><span class="p">[</span><span class="nx">leafShowing</span><span class="p">.</span><span class="nx">view</span><span class="p">].</span><span class="nx">getState</span><span class="p">(),</span><span class="nx">leafShowing</span><span class="p">.</span><span class="nx">viewState</span><span class="p">));</span>
      <span class="p">}</span>
      </pre></div></td></tr><tr id="section-16"><td class="docs"><div class="pilwrap"><a href="#section-16" class="pilcrow">&#182;</a></div><p>reads state of tree</p>
</td><td class="code"><div class="highlight"><pre>      <span class="kd">function</span> <span class="nx">getTreeState</span><span class="p">()</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">tree</span> <span class="o">=</span> <span class="nx">viewTree</span><span class="p">.</span><span class="nx">getData</span><span class="p">().</span><span class="nx">getAllNodes</span><span class="p">();</span></pre></div></td></tr><tr id="section-17"><td class="docs"><div class="pilwrap"><a href="#section-17" class="pilcrow">&#182;</a></div><p>isc.JSON.encode(</p>
</td><td class="code"><div class="highlight"><pre>          <span class="k">return</span> <span class="p">{</span> <span class="nx">width</span><span class="o">:</span> <span class="nx">viewTree</span><span class="p">.</span><span class="nx">getWidth</span><span class="p">(),</span>
                   <span class="nx">time</span><span class="o">:</span> <span class="nx">isc</span><span class="p">.</span><span class="nx">timeStamp</span><span class="p">(),</span>
                   <span class="nx">pathOfLeafShowing</span><span class="o">:</span> <span class="nx">leafShowing</span><span class="p">.</span><span class="nx">path</span><span class="p">,</span></pre></div></td></tr><tr id="section-18"><td class="docs"><div class="pilwrap"><a href="#section-18" class="pilcrow">&#182;</a></div><p>selectedPaths: pathShowing, //viewTree.getSelectedPaths(),
only store data needed to rebuild the tree </p>
</td><td class="code"><div class="highlight"><pre>                   <span class="nx">state</span><span class="o">:</span> <span class="nx">tree</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="p">{</span>
                 <span class="nx">view</span><span class="o">:</span> <span class="nx">n</span><span class="p">.</span><span class="nx">view</span><span class="p">,</span>
                 <span class="nx">id</span><span class="o">:</span> <span class="nx">n</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
                 <span class="nx">parentId</span><span class="o">:</span> <span class="nx">n</span><span class="p">.</span><span class="nx">parentId</span><span class="p">,</span>
                 <span class="nx">isFolder</span><span class="o">:</span> <span class="nx">n</span><span class="p">.</span><span class="nx">isFolder</span><span class="p">,</span>
                 <span class="nx">name</span><span class="o">:</span> <span class="nx">n</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
                 <span class="nx">isOpen</span><span class="o">:</span> <span class="nx">n</span><span class="p">.</span><span class="nx">isOpen</span><span class="p">,</span>  
                 <span class="nx">viewState</span><span class="o">:</span> <span class="nx">n</span><span class="p">.</span><span class="nx">viewState</span>
                   <span class="p">};</span>
                             <span class="p">})</span>
                 <span class="p">};</span>
      <span class="p">}</span>
      
      <span class="kd">function</span> <span class="nx">setModified</span><span class="p">(</span><span class="nx">bool</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr><tr id="section-19"><td class="docs"><div class="pilwrap"><a href="#section-19" class="pilcrow">&#182;</a></div><p>log.d('modified =' + bool);</p>
</td><td class="code"><div class="highlight"><pre>          <span class="nx">modified</span> <span class="o">=</span> <span class="nx">bool</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">modified</span><span class="p">)</span> <span class="nx">saveButton</span><span class="p">.</span><span class="nx">show</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
          <span class="k">else</span> <span class="p">{</span><span class="nx">saveButton</span><span class="p">.</span><span class="nx">hide</span><span class="p">(</span><span class="kc">true</span><span class="p">);}</span>                
      <span class="p">}</span>
      </pre></div></td></tr><tr id="section-20"><td class="docs"><div class="pilwrap"><a href="#section-20" class="pilcrow">&#182;</a></div><p>gets called by currently showing views when their state changes
should be set to the observer of any view implemented</p>
</td><td class="code"><div class="highlight"><pre>      <span class="kd">function</span> <span class="nx">viewStateChanged</span><span class="p">()</span> <span class="p">{</span></pre></div></td></tr><tr id="section-21"><td class="docs"><div class="pilwrap"><a href="#section-21" class="pilcrow">&#182;</a></div><p>log.d('<strong><em>*</em><em>*</em>**</strong>viewstateschanged');</p>
</td><td class="code"><div class="highlight"><pre>          <span class="nx">setModified</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
      <span class="p">}</span>
      </pre></div></td></tr><tr id="section-22"><td class="docs"><div class="pilwrap"><a href="#section-22" class="pilcrow">&#182;</a></div><p>this function gets called everytime a change in the viewtree occurs</p>
</td><td class="code"><div class="highlight"><pre>      <span class="kd">function</span> <span class="nx">treeStateChanged</span><span class="p">(</span><span class="nx">origin</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">log</span><span class="p">.</span><span class="nx">d</span><span class="p">(</span><span class="s1">&#39;******************tree changed: &#39;</span> <span class="o">+</span>  <span class="nx">origin</span><span class="p">);</span>
          <span class="nx">setModified</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span></pre></div></td></tr><tr id="section-23"><td class="docs"><div class="pilwrap"><a href="#section-23" class="pilcrow">&#182;</a></div><p>if (saveOnChange) saveTreeToDb();</p>
</td><td class="code"><div class="highlight"><pre>      <span class="p">}</span>
      
      <span class="kd">function</span> <span class="nx">openLeaf</span><span class="p">(</span><span class="nx">leaf</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">log</span><span class="p">.</span><span class="nx">d</span><span class="p">(</span><span class="s1">&#39;**************************---------------openLeaf&#39;</span><span class="p">);</span></pre></div></td></tr><tr id="section-24"><td class="docs"><div class="pilwrap"><a href="#section-24" class="pilcrow">&#182;</a></div><p>opening same leaf, do nothing</p>
</td><td class="code"><div class="highlight"><pre>          <span class="k">if</span> <span class="p">(</span><span class="nx">leaf</span> <span class="o">===</span> <span class="nx">leafShowing</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
          </pre></div></td></tr><tr id="section-25"><td class="docs"><div class="pilwrap"><a href="#section-25" class="pilcrow">&#182;</a></div><p>save any changes that might have occured in the leaf
if (leafShowing) { //if the tree is empty</p>
</td><td class="code"><div class="highlight"><pre>          <span class="nx">leafShowing</span><span class="p">.</span><span class="nx">viewState</span> <span class="o">=</span>
              <span class="nx">views</span><span class="p">[</span><span class="nx">leafShowing</span><span class="p">.</span><span class="nx">view</span><span class="p">].</span><span class="nx">getState</span><span class="p">();</span> 
    <span class="k">if</span> <span class="p">(</span><span class="nx">leafShowing</span><span class="p">.</span><span class="nx">view</span> <span class="o">!==</span> <span class="nx">leaf</span><span class="p">.</span><span class="nx">view</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">show</span><span class="p">(</span><span class="nx">leafShowing</span><span class="p">.</span><span class="nx">view</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
    <span class="p">}</span></pre></div></td></tr><tr id="section-26"><td class="docs"><div class="pilwrap"><a href="#section-26" class="pilcrow">&#182;</a></div><p>} 
give the component that's about to be shown the specific
data of the new leaf</p>
</td><td class="code"><div class="highlight"><pre>          <span class="nx">views</span><span class="p">[</span><span class="nx">leaf</span><span class="p">.</span><span class="nx">view</span><span class="p">].</span><span class="nx">notify</span><span class="p">(</span><span class="nx">leaf</span><span class="p">.</span><span class="nx">viewState</span><span class="p">);</span></pre></div></td></tr><tr id="section-27"><td class="docs"><div class="pilwrap"><a href="#section-27" class="pilcrow">&#182;</a></div><p>show the leaf, redundant, harmless call if it's the same
type of view</p>
</td><td class="code"><div class="highlight"><pre>          <span class="nx">show</span><span class="p">(</span><span class="nx">leaf</span><span class="p">.</span><span class="nx">view</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>   </pre></div></td></tr><tr id="section-28"><td class="docs"><div class="pilwrap"><a href="#section-28" class="pilcrow">&#182;</a></div><p>set a pointer to the leaf that's now showing</p>
</td><td class="code"><div class="highlight"><pre>          <span class="nx">leafShowing</span> <span class="o">=</span> <span class="nx">leaf</span><span class="p">;</span>
          <span class="nx">leafShowing</span><span class="p">.</span><span class="nx">path</span> <span class="o">=</span> <span class="nx">viewTree</span><span class="p">.</span><span class="nx">getSelectedPaths</span><span class="p">();</span></pre></div></td></tr><tr id="section-29"><td class="docs"><div class="pilwrap"><a href="#section-29" class="pilcrow">&#182;</a></div><p>we're changing views, so set modified flag</p>
</td><td class="code"><div class="highlight"><pre>          <span class="nx">setModified</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
          
         <span class="nx">log</span><span class="p">.</span><span class="nx">d</span><span class="p">(</span><span class="s1">&#39;finished opening leaf&#39;</span><span class="p">);</span>
          
      <span class="p">}</span>
      </pre></div></td></tr><tr id="section-30"><td class="docs"><div class="pilwrap"><a href="#section-30" class="pilcrow">&#182;</a></div><p>var autoSaveState= { id: 'autosave' };
function autoSave(callback) {
    if (!modified) return; 
    // if (!autoSaved) return;
    autoSaveState.state = getTreeState();
    // if (autoSaveState.time )
    autoSaveState.time = isc.timeStamp();
    roster.db.put(autoSaveState, function(err, response) {
        if (err) {
            log.d('ERRROR: Could not save changed state of the view tree.' 
            + err.error + ' ' + err.reason);
            isc.warn('ERROR: Could not save the state of the ui..');
        }
        else {
            log.d('autosaved state');
            autoSaveState._rev = response.rev;
        }
        if (callback) callback();
    });
}</p>
</td><td class="code"><div class="highlight"><pre>      
      <span class="kd">function</span> <span class="nx">saveTreeToDb</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">leafShowing</span><span class="p">.</span><span class="nx">viewState</span> <span class="o">=</span> <span class="nx">views</span><span class="p">[</span><span class="nx">leafShowing</span><span class="p">.</span><span class="nx">view</span><span class="p">].</span><span class="nx">getState</span><span class="p">();</span>
          <span class="nx">log</span><span class="p">.</span><span class="nx">d</span><span class="p">(</span><span class="nx">leafShowing</span><span class="p">.</span><span class="nx">viewState</span><span class="p">);</span> 
          <span class="nx">globals</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">viewTreeState</span> <span class="o">=</span> <span class="nx">isc</span><span class="p">.</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">encode</span><span class="p">(</span><span class="nx">getTreeState</span><span class="p">());</span>
          
          <span class="nx">log</span><span class="p">.</span><span class="nx">d</span><span class="p">(</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="nx">leafShowing</span><span class="p">);</span>
          <span class="nx">log</span><span class="p">.</span><span class="nx">d</span><span class="p">(</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="nx">globals</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">viewTreeState</span><span class="p">);</span>
          <span class="nx">log</span><span class="p">.</span><span class="nx">d</span><span class="p">(</span><span class="s1">&#39;saving tree&#39;</span><span class="p">);</span></pre></div></td></tr><tr id="section-31"><td class="docs"><div class="pilwrap"><a href="#section-31" class="pilcrow">&#182;</a></div><p>TODO get the roster.user from the database and then use
that object to save the ui, or put the ui in a separate
doc...  at the moment there is an update error when you try to
save after modifying the current user in a table for
instance</p>
</td><td class="code"><div class="highlight"><pre>          <span class="nx">globals</span><span class="p">.</span><span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">globals</span><span class="p">.</span><span class="nx">user</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">.</span><span class="nx">d</span><span class="p">(</span><span class="s1">&#39;ERRROR: Could not save changed state of the view tree.&#39;</span> <span class="o">+</span>
                              <span class="nx">err</span><span class="p">.</span><span class="nx">error</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nx">err</span><span class="p">.</span><span class="nx">reason</span><span class="p">);</span>
                  <span class="nx">isc</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s1">&#39;ERROR: Could not save the state of the ui..&#39;</span><span class="p">);</span>
              <span class="p">}</span>
              <span class="k">else</span> <span class="p">{</span>
            <span class="nx">globals</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">_rev</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">rev</span><span class="p">;</span>
                  <span class="nx">log</span><span class="p">.</span><span class="nx">d</span><span class="p">(</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="nx">globals</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">viewTreeState</span><span class="p">);</span>
              <span class="p">}</span>
              <span class="nx">setModified</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span></pre></div></td></tr><tr id="section-32"><td class="docs"><div class="pilwrap"><a href="#section-32" class="pilcrow">&#182;</a></div><p>window.onbeforeunload = function() { };</p>
</td><td class="code"><div class="highlight"><pre>              <span class="k">if</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="nx">callback</span><span class="p">();</span>
          <span class="p">});</span>
      <span class="p">}</span>
      </pre></div></td></tr><tr id="section-33"><td class="docs"><div class="pilwrap"><a href="#section-33" class="pilcrow">&#182;</a></div><p>function setSaveOnChange(bool) { saveOnChange = bool; //
  switch (method) { //case 'auto' : saveOnUnload(); break;
  //case 'onchange' : autoSave = false; break; //default:
  log.d('ERROR: setSaveMethod was called with an
  invalid parameter'); // } }</p>
</td><td class="code"><div class="highlight"><pre>      </pre></div></td></tr><tr id="section-34"><td class="docs"><div class="pilwrap"><a href="#section-34" class="pilcrow">&#182;</a></div><p>if called it sets up saving at intervals and when navigating away
not working because the callback from pouch comes to late, 
everything is wiped already I think
function saveOnUnload() {
  window.setInterval(save, 300000);
  window.onbeforeunload= save;
}</p>
</td><td class="code"><div class="highlight"><pre>      </pre></div></td></tr><tr id="section-35"><td class="docs"><div class="pilwrap"><a href="#section-35" class="pilcrow">&#182;</a></div><p>------------------@manipulate tree---------------------</p>
</td><td class="code"><div class="highlight"><pre>      </pre></div></td></tr><tr id="section-36"><td class="docs"><div class="pilwrap"><a href="#section-36" class="pilcrow">&#182;</a></div><p>function clone() {
    var selRecord = viewTree.getSelectedRecord();
    if (!selRecord) return;
    var view = selRecord.view;
    var state = selRecord.viewState;
    var name = selRecord.name;
    log.d(state);
    if (!selRecord)  selRecord = '/';
    else {
        viewTree.selectRecord(selRecord, false);
        selRecord = selRecord['<em>parent</em>' + tree.ID];
    }
    var newRecord = tree.add({id:isc.timeStamp(),isFolder:false, 
                              name: name + ' (clone)', view: view,
                              viewState : state}, selRecord);
    viewTree.selectRecord(newRecord);
    viewTree.openFolder(selRecord);
    treeStateChanged('clone');
    viewTree.openLeaf(newRecord);
    // ignoreChangeState = true;
}</p>
</td><td class="code"><div class="highlight"><pre>      
      <span class="kd">function</span> <span class="nx">getUniqueName</span><span class="p">(</span><span class="nx">baseName</span><span class="p">,</span> <span class="nx">parent</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">function</span> <span class="nx">nameExists</span><span class="p">(</span><span class="nx">siblings</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">siblings</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                  <span class="kd">var</span> <span class="nx">sibling</span> <span class="o">=</span> <span class="nx">siblings</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                  <span class="k">if</span> <span class="p">(</span><span class="nx">sibling</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="nx">name</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
              <span class="p">}</span> 
              <span class="k">return</span> <span class="nx">i</span> <span class="o">!==</span> <span class="nx">siblings</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="kd">var</span> <span class="nx">newName</span> <span class="o">=</span> <span class="nx">baseName</span><span class="p">;</span> 
          <span class="kd">var</span> <span class="nx">version</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">parent</span> <span class="o">&amp;&amp;</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">children</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">while</span> <span class="p">(</span><span class="nx">nameExists</span><span class="p">(</span><span class="nx">parent</span><span class="p">.</span><span class="nx">children</span><span class="p">,</span> <span class="nx">newName</span><span class="p">))</span> <span class="p">{</span>
                  <span class="nx">newName</span> <span class="o">=</span> <span class="nx">baseName</span> <span class="o">+</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="nx">version</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">;</span>
                  <span class="nx">version</span><span class="o">++</span><span class="p">;</span>
              <span class="p">}</span>
          <span class="p">}</span>
          <span class="k">return</span> <span class="nx">newName</span><span class="p">;</span>
      <span class="p">}</span> 
      
      <span class="kd">function</span> <span class="nx">newView</span><span class="p">(</span><span class="nx">view</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">log</span><span class="p">.</span><span class="nx">d</span><span class="p">(</span><span class="s1">&#39;newView&#39;</span><span class="p">)</span>   <span class="p">;</span>
          <span class="kd">var</span> <span class="nx">selRecord</span> <span class="o">=</span> <span class="nx">viewTree</span><span class="p">.</span><span class="nx">getSelectedRecord</span><span class="p">();</span></pre></div></td></tr><tr id="section-37"><td class="docs"><div class="pilwrap"><a href="#section-37" class="pilcrow">&#182;</a></div><p>var state = selRecord.viewState;</p>
</td><td class="code"><div class="highlight"><pre>          <span class="kd">var</span> <span class="nx">parent</span><span class="p">;</span> 
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">selRecord</span><span class="p">)</span>  <span class="nx">parent</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span><span class="p">;</span>
          <span class="k">else</span> <span class="p">{</span>
              <span class="nx">viewTree</span><span class="p">.</span><span class="nx">selectRecord</span><span class="p">(</span><span class="nx">selRecord</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
              <span class="nx">parent</span> <span class="o">=</span> <span class="nx">selRecord</span><span class="p">[</span><span class="s1">&#39;_parent_&#39;</span> <span class="o">+</span> <span class="nx">tree</span><span class="p">.</span><span class="nx">ID</span><span class="p">];</span>
              
          <span class="p">}</span>
          <span class="kd">var</span> <span class="nx">newName</span> <span class="o">=</span> <span class="nx">getUniqueName</span><span class="p">(</span><span class="nx">view</span><span class="p">,</span> <span class="nx">parent</span><span class="p">);</span>
          <span class="kd">var</span> <span class="nx">newRecord</span> <span class="o">=</span> <span class="nx">tree</span><span class="p">.</span><span class="nx">add</span><span class="p">({</span><span class="nx">id</span><span class="o">:</span><span class="nx">isc</span><span class="p">.</span><span class="nx">timeStamp</span><span class="p">(),</span><span class="nx">isFolder</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span> 
                                    <span class="nx">name</span><span class="o">:</span><span class="nx">newName</span><span class="p">,</span> <span class="nx">view</span><span class="o">:</span> <span class="nx">view</span></pre></div></td></tr><tr id="section-38"><td class="docs"><div class="pilwrap"><a href="#section-38" class="pilcrow">&#182;</a></div><p>,viewState : '{}'</p>
</td><td class="code"><div class="highlight"><pre>                                   <span class="p">},</span> <span class="nx">parent</span><span class="p">);</span>
          
          <span class="nx">viewTree</span><span class="p">.</span><span class="nx">selectRecord</span><span class="p">(</span><span class="nx">newRecord</span><span class="p">);</span></pre></div></td></tr><tr id="section-39"><td class="docs"><div class="pilwrap"><a href="#section-39" class="pilcrow">&#182;</a></div><p>open the parent folder, otherwise we can't see the the new record/view</p>
</td><td class="code"><div class="highlight"><pre>          <span class="nx">viewTree</span><span class="p">.</span><span class="nx">openFolder</span><span class="p">(</span><span class="nx">parent</span><span class="p">);</span></pre></div></td></tr><tr id="section-40"><td class="docs"><div class="pilwrap"><a href="#section-40" class="pilcrow">&#182;</a></div><p>pp('In newView: leafShowing.viewState---------',leafShowing.viewState);</p>
</td><td class="code"><div class="highlight"><pre>          <span class="nx">viewTree</span><span class="p">.</span><span class="nx">openLeaf</span><span class="p">(</span><span class="nx">newRecord</span><span class="p">);</span></pre></div></td></tr><tr id="section-41"><td class="docs"><div class="pilwrap"><a href="#section-41" class="pilcrow">&#182;</a></div><p>eafShowing.viewState = table.getState();
pp('In newView: table.getState---------',leafShowing.viewState);t</p>
</td><td class="code"><div class="highlight"><pre>          <span class="nx">treeStateChanged</span><span class="p">(</span><span class="s1">&#39;newView&#39;</span><span class="p">);</span>
      <span class="p">}</span>
      
      <span class="kd">function</span> <span class="nx">newFolder</span><span class="p">()</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">selRecord</span> <span class="o">=</span> <span class="nx">viewTree</span><span class="p">.</span><span class="nx">getSelectedRecord</span><span class="p">();</span>
          <span class="kd">var</span> <span class="nx">parent</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">selRecord</span><span class="p">)</span>  <span class="nx">parent</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span><span class="p">;</span>
          <span class="k">else</span> <span class="p">{</span>
              <span class="nx">viewTree</span><span class="p">.</span><span class="nx">selectRecord</span><span class="p">(</span><span class="nx">selRecord</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
             <span class="nx">parent</span> <span class="o">=</span> <span class="nx">selRecord</span><span class="p">[</span><span class="s1">&#39;_parent_&#39;</span> <span class="o">+</span> <span class="nx">tree</span><span class="p">.</span><span class="nx">ID</span><span class="p">];</span>
          <span class="p">}</span>
          <span class="kd">var</span> <span class="nx">newName</span> <span class="o">=</span> <span class="nx">getUniqueName</span><span class="p">(</span><span class="s1">&#39;Folder&#39;</span><span class="p">,</span> <span class="nx">parent</span><span class="p">);</span>
          <span class="kd">var</span> <span class="nx">newRecord</span> <span class="o">=</span> <span class="nx">tree</span><span class="p">.</span><span class="nx">add</span><span class="p">({</span><span class="nx">id</span><span class="o">:</span><span class="nx">isc</span><span class="p">.</span><span class="nx">timeStamp</span><span class="p">(),</span><span class="nx">isFolder</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span> 
                                    <span class="nx">name</span><span class="o">:</span> <span class="nx">newName</span><span class="p">},</span> <span class="nx">parent</span><span class="p">);</span>
          <span class="nx">viewTree</span><span class="p">.</span><span class="nx">selectRecord</span><span class="p">(</span><span class="nx">newRecord</span><span class="p">);</span>
          <span class="nx">viewTree</span><span class="p">.</span><span class="nx">openFolder</span><span class="p">(</span><span class="nx">parent</span><span class="p">);</span>
          <span class="nx">treeStateChanged</span><span class="p">(</span><span class="s1">&#39;newFolder&#39;</span><span class="p">);</span>
          <span class="nx">viewTree</span><span class="p">.</span><span class="nx">openFolder</span><span class="p">(</span><span class="nx">newRecord</span><span class="p">);</span>
      <span class="p">}</span>
      
      <span class="kd">function</span> <span class="nx">rename</span><span class="p">()</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">record</span> <span class="o">=</span> <span class="nx">viewTree</span><span class="p">.</span><span class="nx">getSelectedRecord</span><span class="p">();</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">record</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
          <span class="nx">viewTree</span><span class="p">.</span><span class="nx">startEditing</span><span class="p">(</span><span class="nx">viewTree</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">record</span><span class="p">));</span>
          
      <span class="p">}</span>
      
      <span class="kd">function</span> <span class="nx">remove</span><span class="p">()</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">selRecord</span> <span class="o">=</span> <span class="nx">viewTree</span><span class="p">.</span><span class="nx">getSelectedRecord</span><span class="p">();</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">selRecord</span><span class="p">)</span> <span class="p">{</span>
              <span class="kd">var</span> <span class="nx">index</span> <span class="o">=</span> <span class="nx">viewTree</span><span class="p">.</span><span class="nx">getRecordIndex</span><span class="p">(</span><span class="nx">selRecord</span><span class="p">);</span>
              <span class="nx">viewTree</span><span class="p">.</span><span class="nx">removeSelectedData</span><span class="p">();</span>
              <span class="k">if</span> <span class="p">(</span><span class="nx">viewTree</span><span class="p">.</span><span class="nx">getTotalRows</span><span class="p">()</span> <span class="o">===</span> <span class="nx">index</span><span class="p">)</span> <span class="nx">index</span><span class="o">--</span><span class="p">;</span>
              <span class="nx">log</span><span class="p">.</span><span class="nx">d</span><span class="p">(</span><span class="nx">viewTree</span><span class="p">.</span><span class="nx">getTotalRows</span><span class="p">(),</span> <span class="nx">index</span><span class="p">);</span>
              <span class="nx">viewTree</span><span class="p">.</span><span class="nx">selectRecord</span><span class="p">(</span><span class="nx">index</span><span class="p">);</span>
              <span class="nx">treeStateChanged</span><span class="p">(</span><span class="s1">&#39;remove&#39;</span><span class="p">);</span>
          <span class="p">}</span>
      <span class="p">}</span></pre></div></td></tr><tr id="section-42"><td class="docs"><div class="pilwrap"><a href="#section-42" class="pilcrow">&#182;</a></div><p>--------------------------components-------------------
--------------------@MENUS AND TOOLSTRIP
for use in both toolstrip and context menu</p>
</td><td class="code"><div class="highlight"><pre>      </pre></div></td></tr><tr id="section-43"><td class="docs"><div class="pilwrap"><a href="#section-43" class="pilcrow">&#182;</a></div><p>var tableSubMenu = [
    {title:"Everything", 
     click: function() { newView(this.title); } 
     // ,icon: isc.Page.getSkinDir() +"images/actions/add.png"
     // ,submenu:tableSubMenu <br />
    },
    {title:"People",
     click: function() { newView(this.title); } 
     // ,icon: isc.Page.getSkinDir() +"images/actions/add.png"
    },
    {title:"Locations",
     click: function() { newView(this.title); } 
     // ,icon: isc.Page.getSkinDir() +"images/actions/add.png"
    },
    {title:"Shifts",
     click: function() { newView(this.title); } 
     // ,icon: isc.Page.getSkinDir() +"images/actions/add.png"
    }</p>
</td><td class="code"><div class="highlight"><pre>      </pre></div></td></tr><tr id="section-44"><td class="docs"><div class="pilwrap"><a href="#section-44" class="pilcrow">&#182;</a></div><p>];</p>
</td><td class="code"><div class="highlight"><pre>      </pre></div></td></tr><tr id="section-45"><td class="docs"><div class="pilwrap"><a href="#section-45" class="pilcrow">&#182;</a></div><p>TODO different menu for when you click not on a leaf or node?</p>
</td><td class="code"><div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">rightClickMenu2</span> <span class="o">=</span> <span class="nx">isc</span><span class="p">.</span><span class="nx">Menu</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span>
          <span class="p">{</span><span class="c1">// ID:&quot;rightClickMenu&quot;,</span>
              <span class="nx">width</span><span class="o">:</span><span class="mi">150</span>
              <span class="p">,</span><span class="nx">data</span><span class="o">:</span><span class="p">[</span></pre></div></td></tr><tr id="section-46"><td class="docs"><div class="pilwrap"><a href="#section-46" class="pilcrow">&#182;</a></div><p>{title:"Select"
 // ,icon: isc.Page.getSkinDir() +"images/RichTextEditor/copy.png"
 ,click: function() { select(); } 
} 
,{isSeparator:true}
{title:"Clone"
  ,icon: isc.Page.getSkinDir() +"images/RichTextEditor/copy.png"
  ,click: function() { clone(); } 
 } 
,{isSeparator:true}</p>
</td><td class="code"><div class="highlight"><pre>            <span class="p">{</span><span class="nx">title</span><span class="o">:</span><span class="s2">&quot;New folder&quot;</span>
       <span class="p">,</span><span class="nx">icon</span><span class="o">:</span> <span class="nx">isc</span><span class="p">.</span><span class="nx">Page</span><span class="p">.</span><span class="nx">getSkinDir</span><span class="p">()</span> <span class="o">+</span><span class="s2">&quot;images/FileBrowser/createNewFolder.png&quot;</span>
       <span class="p">,</span><span class="nx">click</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">newFolder</span><span class="p">();</span> <span class="p">}</span> 
            <span class="p">}</span> </pre></div></td></tr><tr id="section-47"><td class="docs"><div class="pilwrap"><a href="#section-47" class="pilcrow">&#182;</a></div><p>,{title:"Rename"
  ,icon: isc.Page.getSkinDir() +"images/actions/edit.png"
  ,click: function() { rename(); } 
 },
{title:"Remove"
  ,icon: isc.Page.getSkinDir() +"images/actions/remove.png"
  ,click: function() { remove(); } 
 }
, {isSeparator:true}
,{title:"Save tree"
  ,icon: isc.Page.getSkinDir() +"images/actions/save.png"
  ,click: function() { saveTreeToDb(); }
 }</p>
</td><td class="code"><div class="highlight"><pre>              <span class="p">]</span>
          <span class="p">});</span>
      
      <span class="kd">var</span> <span class="nx">rightClickMenu</span> <span class="o">=</span> <span class="nx">isc</span><span class="p">.</span><span class="nx">Menu</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span>
          <span class="p">{</span><span class="c1">// ID:&quot;rightClickMenu&quot;,</span>
              <span class="nx">width</span><span class="o">:</span><span class="mi">150</span>
              <span class="p">,</span><span class="nx">data</span><span class="o">:</span><span class="p">[</span></pre></div></td></tr><tr id="section-48"><td class="docs"><div class="pilwrap"><a href="#section-48" class="pilcrow">&#182;</a></div><p>{title:"Select"
 // ,icon: isc.Page.getSkinDir() +"images/RichTextEditor/copy.png"
 ,click: function() { select(); } 
} 
,{isSeparator:true}
{title:"Clone"
  ,icon: isc.Page.getSkinDir() +"images/RichTextEditor/copy.png"
  ,click: function() { clone(); } 
 } 
,{isSeparator:true}
{title:"New folder"
 ,icon: isc.Page.getSkinDir() +"images/FileBrowser/createNewFolder.png"
 ,click: function() { newFolder(); } 
} ,</p>
</td><td class="code"><div class="highlight"><pre>            <span class="p">{</span><span class="nx">title</span><span class="o">:</span><span class="s2">&quot;Rename&quot;</span>
        <span class="p">,</span><span class="nx">icon</span><span class="o">:</span> <span class="nx">isc</span><span class="p">.</span><span class="nx">Page</span><span class="p">.</span><span class="nx">getSkinDir</span><span class="p">()</span> <span class="o">+</span><span class="s2">&quot;images/actions/edit.png&quot;</span>
        <span class="p">,</span><span class="nx">click</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">rename</span><span class="p">();</span> <span class="p">}</span> 
             <span class="p">}</span>
            <span class="p">,{</span><span class="nx">title</span><span class="o">:</span><span class="s2">&quot;Remove&quot;</span>
        <span class="p">,</span><span class="nx">icon</span><span class="o">:</span> <span class="nx">isc</span><span class="p">.</span><span class="nx">Page</span><span class="p">.</span><span class="nx">getSkinDir</span><span class="p">()</span> <span class="o">+</span><span class="s2">&quot;images/actions/remove.png&quot;</span>
        <span class="p">,</span><span class="nx">click</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">remove</span><span class="p">();</span> <span class="p">}</span> 
             <span class="p">}</span></pre></div></td></tr><tr id="section-49"><td class="docs"><div class="pilwrap"><a href="#section-49" class="pilcrow">&#182;</a></div><p>, {isSeparator:true}
,{title:"Save tree"
  ,icon: isc.Page.getSkinDir() +"images/actions/save.png"
  ,click: function() { saveTreeToDb(); }
 }</p>
</td><td class="code"><div class="highlight"><pre>              <span class="p">]</span>
          <span class="p">});</span>
      
      <span class="kd">var</span> <span class="nx">loginButton</span> <span class="o">=</span> <span class="nx">isc</span><span class="p">.</span><span class="nx">ToolStripButton</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span>
          <span class="p">{</span>
              <span class="nx">align</span><span class="o">:</span><span class="s1">&#39;left&#39;</span> 
          <span class="p">});</span>
      
      <span class="kd">var</span> <span class="nx">saveButton</span> <span class="o">=</span> <span class="nx">isc</span><span class="p">.</span><span class="nx">ToolStripButton</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
    <span class="nx">icon</span><span class="o">:</span> <span class="s2">&quot;[SKIN]/actions/save.png&quot;</span><span class="p">,</span>
    <span class="nx">prompt</span><span class="o">:</span> <span class="s2">&quot;Save this view&quot;</span>
    <span class="p">,</span><span class="nx">click</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">saveTreeToDb</span><span class="p">();</span> <span class="p">}</span>
      <span class="p">});</span>

      <span class="kd">var</span> <span class="nx">toolStrip</span> <span class="o">=</span> <span class="nx">isc</span><span class="p">.</span><span class="nx">ToolStrip</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span>
          <span class="p">{</span><span class="nx">members</span><span class="o">:</span> <span class="p">[</span>
              <span class="nx">loginButton</span>
        <span class="p">,</span><span class="nx">saveButton</span>     
              <span class="p">,</span><span class="nx">isc</span><span class="p">.</span><span class="nx">LayoutSpacer</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>  <span class="nx">width</span><span class="o">:</span><span class="s2">&quot;*&quot;</span> <span class="p">})</span>
              <span class="p">,</span><span class="nx">isc</span><span class="p">.</span><span class="nx">IconMenuButton</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span><span class="nx">title</span><span class="o">:</span><span class="s1">&#39;&#39;</span>
                  <span class="p">,</span><span class="nx">ID</span><span class="o">:</span><span class="s1">&#39;addButton&#39;</span>
                  <span class="p">,</span><span class="nx">iconClick</span><span class="o">:</span> <span class="s2">&quot;this.showMenu()&quot;</span>
                  <span class="p">,</span><span class="nx">showMenuIcon</span><span class="o">:</span><span class="kc">false</span>
                  <span class="p">,</span><span class="nx">width</span> <span class="o">:</span><span class="mi">20</span>
                  <span class="p">,</span><span class="nx">icon</span><span class="o">:</span> <span class="s2">&quot;[SKIN]/actions/add.png&quot;</span><span class="p">,</span> 
                  <span class="nx">prompt</span><span class="o">:</span> <span class="s2">&quot;Create/clone a view&quot;</span>
                  <span class="p">,</span><span class="nx">menu</span><span class="o">:</span> <span class="p">{</span><span class="nx">width</span><span class="o">:</span><span class="mi">150</span> <span class="p">,</span><span class="nx">data</span><span class="o">:</span> <span class="nx">newViewMenu</span><span class="p">}</span>
                 <span class="p">})</span></pre></div></td></tr><tr id="section-50"><td class="docs"><div class="pilwrap"><a href="#section-50" class="pilcrow">&#182;</a></div><p>,isc.ToolStripButton.create({
    icon: "[SKIN]/RichTextEditor/copy.png",
    prompt: "Clone selected view"
    ,click: function() { clone(); }
})</p>
</td><td class="code"><div class="highlight"><pre>              <span class="p">,</span><span class="nx">isc</span><span class="p">.</span><span class="nx">ToolStripButton</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
            <span class="nx">icon</span><span class="o">:</span> <span class="s2">&quot;[SKIN]/FileBrowser/createNewFolder.png&quot;</span><span class="p">,</span> 
            <span class="nx">prompt</span><span class="o">:</span> <span class="s2">&quot;Create a new folder&quot;</span>
            <span class="p">,</span><span class="nx">click</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">newFolder</span><span class="p">();</span> <span class="p">}</span>
              <span class="p">})</span></pre></div></td></tr><tr id="section-51"><td class="docs"><div class="pilwrap"><a href="#section-51" class="pilcrow">&#182;</a></div><p>,isc.ToolStripButton.create({
    icon: "[SKIN]/actions/edit.png",
    prompt: "Rename selected item"
    ,click: function() { rename(); }
})
,isc.ToolStripButton.create({
    icon: "[SKIN]/actions/remove.png", 
    prompt: "Remove selected item"
    ,click: function() { remove(); }
})</p>
</td><td class="code"><div class="highlight"><pre>          <span class="p">]</span>
          <span class="p">});</span>
      </pre></div></td></tr><tr id="section-52"><td class="docs"><div class="pilwrap"><a href="#section-52" class="pilcrow">&#182;</a></div><p>------------------@VIEWTREE------------------</p>
</td><td class="code"><div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">tree</span> <span class="o">=</span> <span class="nx">isc</span><span class="p">.</span><span class="nx">Tree</span><span class="p">.</span>
    <span class="nx">create</span><span class="p">({</span>
        <span class="nx">ID</span><span class="o">:</span><span class="s1">&#39;tree&#39;</span><span class="p">,</span>
        <span class="nx">modelType</span><span class="o">:</span> <span class="s2">&quot;parent&quot;</span><span class="p">,</span>
        <span class="nx">nameProperty</span><span class="o">:</span> <span class="s2">&quot;id&quot;</span><span class="p">,</span>
        <span class="nx">idField</span><span class="o">:</span> <span class="s2">&quot;id&quot;</span><span class="p">,</span>
        <span class="nx">parentIdField</span><span class="o">:</span> <span class="s2">&quot;parentId&quot;</span><span class="p">,</span>
        <span class="nx">openProperty</span> <span class="o">:</span><span class="s1">&#39;isOpen&#39;</span>
    <span class="p">});</span>

      <span class="kd">var</span> <span class="nx">viewTree</span> <span class="o">=</span> <span class="nx">isc</span><span class="p">.</span><span class="nx">TreeGrid</span><span class="p">.</span>
          <span class="nx">create</span><span class="p">({</span>
              <span class="nx">ID</span><span class="o">:</span> <span class="s1">&#39;treegrid&#39;</span>
        <span class="p">,</span><span class="nx">contextMenu</span><span class="o">:</span><span class="nx">rightClickMenu2</span>
              <span class="p">,</span><span class="nx">showCellContextMenus</span><span class="o">:</span> <span class="kc">true</span>
        <span class="p">,</span><span class="nx">canDragRecordsOut</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span>
        <span class="nx">canAcceptDroppedRecords</span><span class="o">:</span><span class="kc">true</span>
        <span class="p">,</span><span class="nx">canReorderRecords</span><span class="o">:</span> <span class="kc">true</span>
        <span class="p">,</span><span class="nx">data</span><span class="o">:</span> <span class="nx">tree</span> 
        <span class="p">,</span><span class="nx">showHeader</span><span class="o">:</span><span class="kc">false</span>
        <span class="p">,</span><span class="nx">modalEditing</span><span class="o">:</span> <span class="kc">true</span>
        <span class="p">,</span><span class="nx">selectOnEdit</span><span class="o">:</span> <span class="kc">false</span>
        <span class="p">,</span><span class="nx">escapeKeyEditAction</span><span class="o">:</span> <span class="s1">&#39;cancel&#39;</span></pre></div></td></tr><tr id="section-53"><td class="docs"><div class="pilwrap"><a href="#section-53" class="pilcrow">&#182;</a></div><p>,editorExit: function() { this.canEdit = false;}</p>
</td><td class="code"><div class="highlight"><pre>              <span class="p">,</span><span class="nx">canEdit</span><span class="o">:</span> <span class="kc">true</span>
              <span class="p">,</span><span class="nx">leafContextClick</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">rightClickMenu</span><span class="p">.</span><span class="nx">showContextMenu</span><span class="p">();</span> <span class="p">}</span>
              <span class="p">,</span><span class="nx">cellContextClick</span><span class="o">:</span> <span class="s2">&quot;log.d(&#39;hello&#39;)&quot;</span>
        <span class="p">,</span><span class="nx">viewStateChanged</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div></td></tr><tr id="section-54"><td class="docs"><div class="pilwrap"><a href="#section-54" class="pilcrow">&#182;</a></div><p>log.d('vsw');
treeStateChanged('treeStateChanged');</p>
</td><td class="code"><div class="highlight"><pre>                  <span class="kd">var</span> <span class="nx">leaf</span> <span class="o">=</span> <span class="nx">viewTree</span><span class="p">.</span><span class="nx">getSelectedRecord</span><span class="p">();</span>
                  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">leaf</span><span class="p">.</span><span class="nx">isFolder</span><span class="p">)</span>
                      <span class="nx">openLeaf</span><span class="p">(</span><span class="nx">viewTree</span><span class="p">.</span><span class="nx">getSelectedRecord</span><span class="p">());</span>
        <span class="p">}</span>
        <span class="p">,</span><span class="nx">cellChanged</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                  <span class="nx">log</span><span class="p">.</span><span class="nx">d</span><span class="p">(</span><span class="s1">&#39;cell&#39;</span><span class="p">);</span>
            <span class="nx">treeStateChanged</span><span class="p">(</span><span class="s1">&#39;cellChanged&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="p">,</span><span class="nx">onFolderDrop</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">treeStateChanged</span><span class="p">(</span><span class="s1">&#39;onFolderDrop&#39;</span><span class="p">);</span>
        <span class="p">}</span></pre></div></td></tr><tr id="section-55"><td class="docs"><div class="pilwrap"><a href="#section-55" class="pilcrow">&#182;</a></div><p>,openLeaf: openLeaf
,autoFetchData:true //no datasource, so not needed</p>
</td><td class="code"><div class="highlight"><pre>        <span class="p">,</span><span class="nx">gridComponents</span><span class="o">:</span><span class="p">[</span><span class="nx">toolStrip</span><span class="p">,</span> <span class="s2">&quot;header&quot;</span><span class="p">,</span> <span class="s2">&quot;body&quot;</span> <span class="p">]</span>
        <span class="p">,</span><span class="nx">fields</span><span class="o">:</span><span class="p">[{</span>
            <span class="nx">name</span><span class="o">:</span><span class="s2">&quot;name&quot;</span><span class="p">,</span>
            <span class="nx">length</span><span class="o">:</span><span class="mi">128</span><span class="p">,</span>
            <span class="nx">type</span><span class="o">:</span><span class="s2">&quot;text&quot;</span>
        <span class="p">}</span>
          <span class="p">]</span>
    <span class="p">});</span>
      <span class="kd">function</span> <span class="nx">isEqual</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">a</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">b</span><span class="p">)</span> <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">a</span> <span class="o">||</span> <span class="o">!</span><span class="nx">b</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
          <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">p</span> <span class="k">in</span> <span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
              <span class="kd">var</span> <span class="nx">same</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
              <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">a</span><span class="p">[</span><span class="nx">p</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="nx">same</span> <span class="o">=</span> <span class="nx">isEqual</span><span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="nx">p</span><span class="p">],</span> <span class="nx">b</span><span class="p">[</span><span class="nx">p</span><span class="p">]);</span>
              <span class="k">else</span> <span class="p">{</span>
                  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">a</span><span class="p">[</span><span class="nx">p</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">b</span><span class="p">[</span><span class="nx">p</span><span class="p">])</span> <span class="nx">same</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                  <span class="k">else</span> <span class="nx">same</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="nx">p</span><span class="p">]</span> <span class="o">===</span> <span class="nx">b</span><span class="p">[</span><span class="nx">p</span><span class="p">]);</span>   
              <span class="p">}</span>
              
              <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">same</span><span class="p">){</span></pre></div></td></tr><tr id="section-56"><td class="docs"><div class="pilwrap"><a href="#section-56" class="pilcrow">&#182;</a></div><p>log.d(p);
log.d(a, b);</p>
</td><td class="code"><div class="highlight"><pre>                  <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>  
              <span class="p">}</span> 
          <span class="p">}</span>
          <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>   
      <span class="p">}</span>
      
      <span class="nb">window</span><span class="p">.</span><span class="nx">onbeforeunload</span><span class="o">=</span> 
    <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> </pre></div></td></tr><tr id="section-57"><td class="docs"><div class="pilwrap"><a href="#section-57" class="pilcrow">&#182;</a></div><p>pp('current state', table.getState());
pp('original state', leafShowing.viewState);
pp(isEqual(table.getState(), leafShowing.viewState));                   </p>
</td><td class="code"><div class="highlight"><pre>              <span class="k">if</span> <span class="p">(</span><span class="nx">isEqual</span><span class="p">(</span><span class="nx">views</span><span class="p">[</span><span class="nx">leafShowing</span><span class="p">.</span><span class="nx">view</span><span class="p">].</span><span class="nx">getState</span><span class="p">(),</span> <span class="nx">leafShowing</span><span class="p">.</span><span class="nx">viewState</span><span class="p">))</span> <span class="p">{</span></pre></div></td></tr><tr id="section-58"><td class="docs"><div class="pilwrap"><a href="#section-58" class="pilcrow">&#182;</a></div><p>if (isEqual(table.getState(), leafShowing.viewState)) {</p>
</td><td class="code"><div class="highlight"><pre>                  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">modified</span><span class="p">)</span> <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
                  <span class="k">return</span> <span class="kc">null</span><span class="p">;</span></pre></div></td></tr><tr id="section-59"><td class="docs"><div class="pilwrap"><a href="#section-59" class="pilcrow">&#182;</a></div><p>else return 'Leaving will discard changes made to the organising tree.'+
    '\n Select "Stay on this page" and then click the icon next to '+
    'the login name to save the changes.';</p>
</td><td class="code"><div class="highlight"><pre>              <span class="p">}</span>
              <span class="nx">leafShowing</span><span class="p">.</span><span class="nx">viewState</span> <span class="o">=</span> <span class="nx">views</span><span class="p">[</span><span class="nx">leafShowing</span><span class="p">.</span><span class="nx">view</span><span class="p">].</span><span class="nx">getState</span><span class="p">();</span>
              <span class="nx">setModified</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span></pre></div></td></tr><tr id="section-60"><td class="docs"><div class="pilwrap"><a href="#section-60" class="pilcrow">&#182;</a></div><p>saveTreeToDb();
return 'Leaving will discard changes made to a view.\n\nSelect "Stay on '+
    'this page" and then click the icon next to the login name to ' +
    'save the changes.';</p>
</td><td class="code"><div class="highlight"><pre>              <span class="k">return</span> <span class="kc">null</span><span class="p">;</span></pre></div></td></tr><tr id="section-61"><td class="docs"><div class="pilwrap"><a href="#section-61" class="pilcrow">&#182;</a></div><p>return 'Leaving will discard changes made to a
view.\nStay to save the changes.';</p>
</td><td class="code"><div class="highlight"><pre>          <span class="p">};</span>
      </pre></div></td></tr><tr id="section-62"><td class="docs"><div class="pilwrap"><a href="#section-62" class="pilcrow">&#182;</a></div><p>-----------------------@API-----------------------
sets the show function so that viewTree has a means to show/hide 
components</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nx">viewTree</span><span class="p">.</span><span class="nx">setShow</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span> <span class="nx">show</span> <span class="o">=</span> <span class="nx">f</span><span class="p">;</span> <span class="p">};</span></pre></div></td></tr><tr id="section-63"><td class="docs"><div class="pilwrap"><a href="#section-63" class="pilcrow">&#182;</a></div><p>to set viewTree to a new state</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nx">viewTree</span><span class="p">.</span><span class="nx">notify</span> <span class="o">=</span> <span class="nx">notify</span><span class="p">;</span>
      <span class="nx">viewTree</span><span class="p">.</span><span class="nx">ls</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="nx">log</span><span class="p">.</span><span class="nx">d</span><span class="p">(</span><span class="nx">leafShowing</span><span class="p">);</span>
      <span class="p">};</span></pre></div></td></tr><tr id="section-64"><td class="docs"><div class="pilwrap"><a href="#section-64" class="pilcrow">&#182;</a></div><p>exposes the loginButton, not really part of this component.</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nx">viewTree</span><span class="p">.</span><span class="nx">loginButton</span> <span class="o">=</span> <span class="nx">loginButton</span><span class="p">;</span>
      <span class="k">return</span> <span class="nx">viewTree</span><span class="p">;</span>
  <span class="p">}});</span></pre></div></td></tr><tr id="section-65"><td class="docs"><div class="pilwrap"><a href="#section-65" class="pilcrow">&#182;</a></div><p>function inf() {
    var temp = module.viewTree.getData().root.children;
    log.d(temp[0].name, temp[0].viewState.grid);
    log.d(temp[1].name, temp[1].viewState.grid);
}</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr></tbody></table><div id="generated">generated Thu Jan 17 2013 03:12:18 GMT+1000 (EST)  </div></div></body></html>